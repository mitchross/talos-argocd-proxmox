apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - projects.yaml
  # Critical applications with specific sync waves to prevent race conditions
  # Wave 0: Foundation components (networking + secrets infrastructure)
  - cilium-app.yaml        # Wave 0 - Networking foundation
  - 1passwordconnect.yaml  # Wave 0 - Secret backend (required by External Secrets)
  - external-secrets.yaml  # Wave 0 - External Secrets CRDs (required by Longhorn)
  - longhorn-app.yaml      # Wave 1 - Storage foundation
  - snapshot-controller-app.yaml # Wave 1 - VolumeSnapshot controller + CRDs
  - volsync-app.yaml       # Wave 1 - PVC backup and replication
  - pvc-plumber-app.yaml   # Wave 2 - Backup existence checker (before Kyverno)
  # ApplicationSets for automatic discovery
  - infrastructure-appset.yaml  # Wave 4
  - monitoring-appset.yaml      # Wave 3
  - my-apps-appset.yaml         # Wave 4
