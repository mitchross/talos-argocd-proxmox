---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: pvc-plumber-config
  namespace: volsync-system
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: onepassword-connect
  target:
    name: pvc-plumber-config
    creationPolicy: Owner
  data:
    # S3 endpoint and bucket for checking backup existence
    # NOTE: Add these fields to your 'rustfs' 1Password item:
    #   - endpoint: http://192.168.10.133:30292
    #   - bucket: volsync-backup
    - secretKey: S3_ENDPOINT
      remoteRef:
        key: rustfs
        property: endpoint
    - secretKey: S3_BUCKET
      remoteRef:
        key: rustfs
        property: bucket
    # AWS credentials for authenticated S3 access (k8s-admin)
    - secretKey: AWS_ACCESS_KEY_ID
      remoteRef:
        key: rustfs
        property: k8s-admin-access-key
    - secretKey: AWS_SECRET_ACCESS_KEY
      remoteRef:
        key: rustfs
        property: k8s-admin-secret-key
